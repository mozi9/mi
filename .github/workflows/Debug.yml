name: Create New cs Branch via API

on:
  workflow_dispatch:

jobs:
  create-branch:
    runs-on: ubuntu-latest
    steps:
    - name: Get source branch commit SHA
      id: get-sha
      run: |
        SHA=$(curl -s -H "Authorization: token ${{ secrets.MOZI9 }}" \
          "https://api.github.com/repos/mozi9/mi/git/refs/heads/cc" | \
          jq -r '.object.sha')
        echo "commit_sha=$SHA" >> $GITHUB_OUTPUT
        echo "源分支 cc 的最新提交: $SHA"

    - name: Create new cs branch
      run: |
        curl -X POST \
          -H "Authorization: token ${{ secrets.MOZI9 }}" \
          -H "Accept: application/vnd.github.v3+json" \
          "https://api.github.com/repos/mozi9/kernel_xiaomi_sm8250/git/refs" \
          -d '{
            "ref": "refs/heads/cs",
            "sha": "${{ steps.get-sha.outputs.commit_sha }}"
          }'
        echo "✅ 新分支 cs 创建成功！"

    - name: Verify new branch
      run: |
        curl -s -H "Authorization: token ${{ secrets.MOZI9 }}" \
          "https://api.github.com/repos/mozi9/kernel_xiaomi_sm8250/branches/cs" | \
          jq '{name: .name, commit: .commit.sha}'
        echo "✅ 验证完成"
