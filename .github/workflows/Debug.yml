name: Create and Push cs Branch

on:
  workflow_dispatch:

jobs:
  push-branch:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
    - name: Clone source repository
      run: |
        rm -rf source-repo
        git clone https://mozi9:${{ secrets.MOZI9 }}@github.com/mozi9/mi.git -b cc source-repo
        cd source-repo
        echo "✅ 源仓库克隆完成，提交数: $(git rev-list --count HEAD)"

    - name: Configure Git
      run: |
        cd source-repo
        git config user.name "mozi9"
        git config user.email "mozi9@users.noreply.github.com"

    - name: Push to new branch
      run: |
        cd source-repo
        echo "开始推送到新分支 cs..."
        git push https://mozi9:${{ secrets.MOZI9 }}@github.com/mozi9/kernel_xiaomi_sm8250.git HEAD:cs
        echo "✅ 推送完成！"

    - name: Verify push
      run: |
        cd source-repo
        echo "验证推送结果："
        git ls-remote https://mozi9:${{ secrets.MOZI9 }}@github.com/mozi9/kernel_xiaomi_sm8250.git cs
        echo "✅ 新分支 cs 创建并推送成功！"
