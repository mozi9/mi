name: Debug Sync Issue

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    
    steps:
    - name: Check Secret Existence
      run: |
        echo "MOZI9_TOKEN exists: ${{ secrets.MOZI9_TOKEN != '' }}"
        echo "GITHUB_TOKEN exists: ${{ secrets.GITHUB_TOKEN != '' }}"
        
    - name: Test API Access with Token
      run: |
        # 测试令牌是否能访问API
        response=$(curl -s -H "Authorization: token ${{ secrets.MOZI9_TOKEN }}" \
          -H "Accept: application/vnd.github.v3+json" \
          https://api.github.com/user)
        echo "API Response: $response"
        
    - name: Test Repository Access
      run: |
        # 测试是否能访问源仓库
        curl -H "Authorization: token ${{ secrets.MOZI9_TOKEN }}" \
          https://api.github.com/repos/mozi9/mi | jq '{name: .name, permissions: .permissions}'
          
    - name: Manual Clone Test
      run: |
        # 手动测试克隆操作
        git clone https://${{ secrets.MOZI9_TOKEN }}@github.com/mozi9/mi.git -b cs manual-test
        cd manual-test && echo "Manual clone successful!"
